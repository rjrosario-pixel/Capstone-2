<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phishing Scanner</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body class="dash-body">
  <header>
    <div class="logo">
      <img src="/static/logo.png" alt="logo" />
    </div>
    <nav>
      <a href="Scanner.html">URL and Domain Scanner</a>
      <a href="BlockPage.html">Blocking</a>
      <a href="dash.html" class="active">Dashboard</a>
    </nav>
    <div class="profile">
  <nav class="notification-nav">
    <span class="bell" title="Notifications">ðŸ””</span>
  </nav>
  <span id="nav-user">User</span>
  <div class="dropdown">
    <button id="menu-btn" class="menu-btn">â‹®</button>
    <div class="dropdown-content" id="dropdown-menu">
      <button id="logout-btn">Log Out</button>
    </div>
  </div>
</div>

  </header>

  <main class="container">
    <h1>Dashboard</h1>
    <div class="status-cards">
      <div class="card green">
        <p>Activity</p>
        <h2 id="scan-count">0</h2>
        <p>You scanned X websites today</p>
      </div>
      <div class="card red">
        <p>Block Threats</p>
        <h2 id="block-count">0</h2>
        <p>X phishing URLs/Domains were blocked today</p>
      </div>
      <div class="card yellow">
        <p>Alerts</p>
        <h2>âœ… Safe!</h2>
        <p>You visited a verified site: https://www.example.com</p>
      </div>
      <div class="card gray">
        <p>Blacklist Updates</p>
        <h2>Updated just now</h2>
        <p>Your phishing blacklist is up to date</p>
      </div>
    </div>

    <section class="chart-section">
      <div class="section-header">
        <h2>Phishing URLs and Domains Blocked</h2>
        <select>
          <option>Last 1 year</option>
          <option>Last 6 months</option>
        </select>
      </div>
      <div class="chart-placeholder">[Line chart placeholder]</div>
    </section>

    <section class="history">
      <div class="section-header">
        <h2>History</h2>
        <select>
          <option>Last 24 hours</option>
          <option>Last 7 days</option>
        </select>
      </div>
      <table>
        <thead>
          <tr>
            <th>Source URL</th>
            <th>Domain Name</th>
            <th>IP Address</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="history-table">
          <!-- Data from Firestore will go here -->
        </tbody>
      </table>
    </section>
  </main>

  <script type="module">
    
    // Toggle dropdown visibility
const menuBtn = document.getElementById("menu-btn");
const dropdown = document.getElementById("dropdown-menu");
menuBtn.addEventListener("click", () => {
  dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
});

// Logout
document.getElementById("logout-btn").addEventListener("click", async () => {
  await auth.signOut();
  window.location.href = "login.html";
});


    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtzvIR11c-NBvCrfiulpW3Vs0rNWmMJao",
      authDomain: "terraphish-a125f.firebaseapp.com",
      projectId: "terraphish-a125f",
      storageBucket: "terraphish-a125f.appspot.com",
      messagingSenderId: "539516088656",
      appId: "1:539516088656:web:fec9092a9f7fd99901bc55",
      measurementId: "G-0RSTFT0X1F"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userName = document.getElementById("user-name");
    const scanCount = document.getElementById("scan-count");
    const blockCount = document.getElementById("block-count");
    const historyTable = document.getElementById("history-table");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      userName.textContent = user.email;

      const q = query(collection(db, "phishing_urls"), where("uid", "==", user.uid));
      const querySnapshot = await getDocs(q);

      let scans = 0;
      let blocks = 0;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        scans++;
        if (data.result === "phish") blocks++;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.url}</td>
          <td>${data.domain || "-"}</td>
          <td>${data.ip || "-"}</td>
          <td><span class="status ${data.result}">${data.result}</span></td>
        `;
        historyTable.appendChild(row);
      });

      scanCount.textContent = scans;
      blockCount.textContent = blocks;
    });
  </script>
</body>
</html>
